<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.0.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100%;
            width: 100%;
            background: black;
        }

        .a-enter-vr-button {
            display: none !important;
        }

        #bottom-ui {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 50px 50px;
            box-sizing: border-box;
            z-index: 5;
            display: none;
        }

        .scroll-arrow {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 60px;
            height: 60px;
            font-size: 28px;
            color: white;
            background: rgba(0, 0, 0, 0.6);
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            user-select: none;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            border: 2px solid rgba(255, 255, 255, 0.3);
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            outline: none;
        }

        .scroll-arrow.active {
            opacity: 1;
            pointer-events: all;
        }

        #scroll-left {
            left: 15px;
        }

        #scroll-right {
            right: 15px;
        }

        #model-info {
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 5px;
            max-width: 100%;
        }

        #model-name {
            font-family: 'Arial', sans-serif;
            color: white;
            font-size: 30px;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 80vw;
        }

        #model-price {
            font-family: 'Arial', sans-serif;
            border-radius: 6px;
            color: white;
            background-color: rgba(30, 144, 255, 0.7);
            font-size: 30px;
            min-width: 100px;
            height: 36px;
            line-height: 36px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            padding: 0 15px;
        }

        a-scene {
            background: linear-gradient(to bottom, #FFFFFF, #808080);
            display: block;
            opacity: 0;
            transition: opacity 0.5s ease;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        a-scene.active {
            opacity: 1;
        }

        #loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            color: white;
            font-family: 'Arial', sans-serif;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #loading-text {
            margin-top: 10px;
            font-size: 16px;
            text-align: center;
        }

        #welcome-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            color: white;
            font-family: 'Arial', sans-serif;
        }

        /* Logo container styles */
        .logo-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .logo-name {
            font-family: 'Arial', sans-serif;
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin-top: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        /* Button Grid Layout */
        .button-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            width: 90%;
            max-width: 500px;
            margin: 20px auto;
            justify-items: center;
        }

        .grid-button {
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100px;
            height: 100px;
            text-align: center;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        #view-pdf-button {
            background: #ff6b6b;
        }

        #view-3d-button {
            background: #1e90ff;
        }

        #whatsapp-button {
            background: #25D366;
        }

        .button-icon {
            width: 40px;
            height: 40px;
            margin-bottom: 8px;
        }

        #logo {
            max-width: 180px;
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .button-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 400px) {
            .grid-button {
                width: 90px;
                height: 90px;
                font-size: 14px;
            }
            
            .logo-name {
                font-size: 20px;
            }
            
            .button-icon {
                width: 35px;
                height: 35px;
            }
        }

        /* Back button styles */
        #back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 80px;
            height: 40px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            background: rgba(0, 0, 0, 0.6);
            cursor: pointer;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            user-select: none;
            z-index: 15;
            opacity: 0;
            pointer-events: none;
            border: 2px solid rgba(255, 255, 255, 0.3);
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            outline: none;
            text-transform: uppercase;
        }
        
        #back-button.active {
            opacity: 1;
            pointer-events: all;
        }
    </style>
</head>
<body>
    <div id="welcome-screen">
        <div class="logo-container">  
            <img id="logo" src="https://arqrassets.s3.ap-south-1.amazonaws.com/CoffeeLogo.png" alt="Logo" />
            <div class="logo-name">ENSO COFFEE</div>
        </div>
        <div class="button-container">
            <button id="view-pdf-button" class="grid-button">
                <img class="button-icon" src="https://arqrassets.s3.ap-south-1.amazonaws.com/CoffeeLogo.png" alt="Menu" />
                Menu
            </button>
            <button id="view-3d-button" class="grid-button">
                <svg class="button-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 6V12L16 14" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                3D View
            </button>
            <button id="whatsapp-button" class="grid-button">
                <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 48 48" width="480px" height="480px" fill-rule="evenodd" clip-rule="evenodd"><path fill="#fff" d="M4.868,43.303l2.694-9.835C5.9,30.59,5.026,27.324,5.027,23.979C5.032,13.514,13.548,5,24.014,5c5.079,0.002,9.845,1.979,13.43,5.566c3.584,3.588,5.558,8.356,5.556,13.428c-0.004,10.465-8.522,18.98-18.986,18.98c-0.001,0,0,0,0,0h-0.008c-3.177-0.001-6.3-0.798-9.073-2.311L4.868,43.303z"/><path fill="#fff" d="M4.868,43.803c-0.132,0-0.26-0.052-0.355-0.148c-0.125-0.127-0.174-0.312-0.127-0.483l2.639-9.636c-1.636-2.906-2.499-6.206-2.497-9.556C4.532,13.238,13.273,4.5,24.014,4.5c5.21,0.002,10.105,2.031,13.784,5.713c3.679,3.683,5.704,8.577,5.702,13.781c-0.004,10.741-8.746,19.48-19.486,19.48c-3.189-0.001-6.344-0.788-9.144-2.277l-9.875,2.589C4.953,43.798,4.911,43.803,4.868,43.803z"/><path fill="#cfd8dc" d="M24.014,5c5.079,0.002,9.845,1.979,13.43,5.566c3.584,3.588,5.558,8.356,5.556,13.428c-0.004,10.465-8.522,18.98-18.986,18.98h-0.008c-3.177-0.001-6.3-0.798-9.073-2.311L4.868,43.303l2.694-9.835C5.9,30.59,5.026,27.324,5.027,23.979C5.032,13.514,13.548,5,24.014,5 M24.014,42.974C24.014,42.974,24.014,42.974,24.014,42.974C24.014,42.974,24.014,42.974,24.014,42.974 M24.014,42.974C24.014,42.974,24.014,42.974,24.014,42.974C24.014,42.974,24.014,42.974,24.014,42.974 M24.014,4C24.014,4,24.014,4,24.014,4C12.998,4,4.032,12.962,4.027,23.979c-0.001,3.367,0.849,6.685,2.461,9.622l-2.585,9.439c-0.094,0.345,0.002,0.713,0.254,0.967c0.19,0.192,0.447,0.297,0.711,0.297c0.085,0,0.17-0.011,0.254-0.033l9.687-2.54c2.828,1.468,5.998,2.243,9.197,2.244c11.024,0,19.99-8.963,19.995-19.98c0.002-5.339-2.075-10.359-5.848-14.135C34.378,6.083,29.357,4.002,24.014,4L24.014,4z"/><path fill="#40c351" d="M35.176,12.832c-2.98-2.982-6.941-4.625-11.157-4.626c-8.704,0-15.783,7.076-15.787,15.774c-0.001,2.981,0.833,5.883,2.413,8.396l0.376,0.597l-1.595,5.821l5.973-1.566l0.577,0.342c2.422,1.438,5.2,2.198,8.032,2.199h0.006c8.698,0,15.777-7.077,15.78-15.776C39.795,19.778,38.156,15.814,35.176,12.832z"/><path fill="#fff" fill-rule="evenodd" d="M19.268,16.045c-0.355-0.79-0.729-0.806-1.068-0.82c-0.277-0.012-0.593-0.011-0.909-0.011c-0.316,0-0.83,0.119-1.265,0.594c-0.435,0.475-1.661,1.622-1.661,3.956c0,2.334,1.7,4.59,1.937,4.906c0.237,0.316,3.282,5.259,8.104,7.161c4.007,1.58,4.823,1.266,5.693,1.187c0.87-0.079,2.807-1.147,3.202-2.255c0.395-1.108,0.395-2.057,0.277-2.255c-0.119-0.198-0.435-0.316-0.909-0.554s-2.807-1.385-3.242-1.543c-0.435-0.158-0.751-0.237-1.068,0.238c-0.316,0.474-1.225,1.543-1.502,1.859c-0.277,0.317-0.554,0.357-1.028,0.119c-0.474-0.238-2.002-0.738-3.815-2.354c-1.41-1.257-2.362-2.81-2.639-3.285c-0.277-0.474-0.03-0.731,0.208-0.968c0.213-0.213,0.474-0.554,0.712-0.831c0.237-0.277,0.316-0.475,0.474-0.791c0.158-0.317,0.079-0.594-0.04-0.831C20.612,19.329,19.69,16.983,19.268,16.045z" clip-rule="evenodd"/></svg>
                WhatsApp
            </button>
        </div>
    </div>

    <div id="loading-screen">
        <div class="spinner"></div>
        <div id="loading-text">Loading 3D Models...</div>
    </div>

    <button id="back-button" class="back-button">Back</button>

    <div id="scroll-left" class="scroll-arrow">&#10094;</div>
    <div id="scroll-right" class="scroll-arrow">&#10095;</div>

    <div id="bottom-ui">
        <div id="model-info">
            <div id="model-name">Loading...</div>
            <div id="model-price">Loading...</div>
        </div>
    </div>

    <a-scene embedded>
        <a-assets id="dynamic-assets"></a-assets>
        <a-entity id="cameraRig">
            <a-camera position="0 1.6 0" look-controls="enabled: false"></a-camera>
        </a-entity>
        <a-entity id="model-container" position="0 1.6 -2">
            <a-entity id="model-parent" position="0 0 0" drag-rotate scale="5 5 5">
                <!-- Models will be added here -->
            </a-entity>
        </a-entity>
        <a-entity environment="preset: default; groundColor: #445; grid: none"></a-entity>
    </a-scene>

    <script>
        // Register drag-rotate component
        AFRAME.registerComponent('drag-rotate', {
            schema: {
                speed: { type: 'number', default: 0.5 }
            },
            init: function () {
                this.pitch = THREE.MathUtils.degToRad(30);
                this.yaw = 0;
                this.dragging = false;
                this.startX = 0;
                this.startY = 0;
                this.updateRotation();

                this.onMouseDown = (e) => {
                    this.dragging = true;
                    this.startX = e.clientX;
                    this.startY = e.clientY;
                };

                this.onMouseMove = (e) => {
                    if (!this.dragging) return;
                    const dx = e.clientX - this.startX;
                    const dy = e.clientY - this.startY;

                    this.yaw += dx * 0.02 * this.data.speed;
                    this.pitch += dy * 0.02 * this.data.speed;

                    this.pitch = THREE.MathUtils.clamp(this.pitch, THREE.MathUtils.degToRad(-90), THREE.MathUtils.degToRad(90));

                    this.startX = e.clientX;
                    this.startY = e.clientY;
                    this.updateRotation();
                };

                this.onMouseUp = () => { this.dragging = false; };

                this.onTouchStart = (e) => {
                    if (e.touches.length === 1) {
                        this.dragging = true;
                        this.startX = e.touches[0].clientX;
                        this.startY = e.touches[0].clientY;
                    }
                };

                this.onTouchMove = (e) => {
                    if (!this.dragging || e.touches.length !== 1) return;
                    const dx = e.touches[0].clientX - this.startX;
                    const dy = e.touches[0].clientY - this.startY;

                    this.yaw += dx * 0.02 * this.data.speed;
                    this.pitch += dy * 0.02 * this.data.speed;

                    this.pitch = THREE.MathUtils.clamp(this.pitch, THREE.MathUtils.degToRad(-90), THREE.MathUtils.degToRad(90));

                    this.startX = e.touches[0].clientX;
                    this.startY = e.touches[0].clientY;
                    this.updateRotation();
                };

                this.onTouchEnd = () => { this.dragging = false; };

                window.addEventListener('mousedown', this.onMouseDown);
                window.addEventListener('mousemove', this.onMouseMove);
                window.addEventListener('mouseup', this.onMouseUp);
                window.addEventListener('touchstart', this.onTouchStart, { passive: false });
                window.addEventListener('touchmove', this.onTouchMove, { passive: false });
                window.addEventListener('touchend', this.onTouchEnd);
            },
            updateRotation: function () {
                this.el.object3D.rotation.set(this.pitch, this.yaw, 0);
            },
            remove: function () {
                window.removeEventListener('mousedown', this.onMouseDown);
                window.removeEventListener('mousemove', this.onMouseMove);
                window.removeEventListener('mouseup', this.onMouseUp);
                window.removeEventListener('touchstart', this.onTouchStart);
                window.removeEventListener('touchmove', this.onTouchMove);
                window.removeEventListener('touchend', this.onTouchEnd);
            }
        });

        // Main application
        document.addEventListener('DOMContentLoaded', function() {
            const welcomeScreen = document.getElementById("welcome-screen");
            const viewPdfButton = document.getElementById("view-pdf-button");
            const view3dButton = document.getElementById("view-3d-button");
            const whatsappButton = document.getElementById("whatsapp-button");
            const scrollLeftBtn = document.getElementById("scroll-left");
            const scrollRightBtn = document.getElementById("scroll-right");
            const backButton = document.getElementById("back-button");
            const modelName = document.getElementById("model-name");
            const modelPrice = document.getElementById("model-price");
            const assets = document.getElementById("dynamic-assets");
            const modelParent = document.getElementById("model-parent");
            const loadingScreen = document.getElementById("loading-screen");
            const loadingText = document.getElementById("loading-text");
            const scene = document.querySelector("a-scene");
            const bottomUI = document.getElementById("bottom-ui");

            let modelData = [];
            let currentModelIndex = 0;
            let modelEntities = [];
            let modelsLoaded = false;

            const ZOOM_MIN = 5;
            const ZOOM_MAX = 12;
            const ZOOM_DEFAULT = 5;
            let zoomFactor = ZOOM_DEFAULT;

            // Initialize the app
            async function initApp() {
                // Show loading screen while loading models
                loadingScreen.style.display = 'flex';
                
                // Load model data and create model entities
                modelData = await fetchGoogleSheetCSV();
                
                if (modelData.length > 0) {
                    // Create all model entities but keep them hidden
                    await createModelEntities(modelData);
                    modelsLoaded = true;
                    
                    viewPdfButton.addEventListener('click', () => {
                        // Open PDF in new tab
                        window.open(modelData[currentModelIndex].pdfUrl || 'https://drive.google.com/file/d/1Tc_l1N5MjnIFsxc0RwFMzpGb3a8SXzf1/view?usp=drive_link', '_blank');
                    });

                    view3dButton.addEventListener('click', () => {
                        // Hide welcome screen and show 3D viewer
                        welcomeScreen.style.display = 'none';
                        show3DViewer();
                    });

                    // Set up WhatsApp button click handler
                    whatsappButton.addEventListener('click', () => {
                        const phoneNumber = '1234567890'; 
                        const message = 'Hello, I have a question about your products';
                        window.open(`https://wa.me/${+918128955751}?text=${encodeURIComponent(message)}`, '_blank');
                    });
                    
                    loadingScreen.style.display = 'none';
                } else {
                    loadingText.textContent = "No models available";
                    viewPdfButton.disabled = true;
                    view3dButton.disabled = true;
                    viewPdfButton.textContent = "No Models Available";
                    view3dButton.textContent = "No Models Available";
                }
            }

            // Update visible model
            function updateVisibleModel() {
                modelEntities.forEach((model, i) => {
                    model.setAttribute('visible', i === currentModelIndex);
                });

                if (modelData[currentModelIndex]) {
                    modelName.textContent = modelData[currentModelIndex].name;
                    modelPrice.textContent = modelData[currentModelIndex].price;
                }

                // Reset zoom and rotation
                zoomFactor = ZOOM_DEFAULT;
                modelParent.setAttribute('scale', `${zoomFactor} ${zoomFactor} ${zoomFactor}`);
                
                const comp = modelParent.components['drag-rotate'];
                if (comp) {
                    comp.pitch = THREE.MathUtils.degToRad(45);
                    comp.yaw = 0;
                    comp.updateRotation();
                }
            }

            // Set up button events
            function setupButtonEvents() {
                const changeModel = (dir) => {
                    currentModelIndex = (currentModelIndex + dir + modelEntities.length) % modelEntities.length;
                    updateVisibleModel();
                };

                scrollLeftBtn.addEventListener("click", () => changeModel(-1));
                scrollRightBtn.addEventListener("click", () => changeModel(1));
                
                // Add back button event
                backButton.addEventListener("click", () => {
                    // Hide 3D viewer and show welcome screen
                    scene.classList.remove('active');
                    scrollLeftBtn.classList.remove('active');
                    scrollRightBtn.classList.remove('active');
                    bottomUI.style.display = 'none';
                    backButton.classList.remove('active');
                    welcomeScreen.style.display = 'flex';
                });
            }

            // Fetch model data from Google Sheets
            async function fetchGoogleSheetCSV() {
                loadingText.textContent = "Fetching model data...";
                
                try {
                    const proxy = "https://api.allorigins.win/raw?url=";
                    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTKjBezjVa5ZwSJrTxN3rsgZ8GIT3h9ySMyKqEfV1SkSMAge3OPyvh_r9-eK6JQAKza4i0S-0puOo64/pub?gid=0&single=true&output=csv";
                    const response = await fetch(proxy + encodeURIComponent(sheetUrl));
                    const text = await response.text();
                    const results = Papa.parse(text, { header: true });
                    
                    return results.data.map(row => {
                        return {
                            name: row['Model Name'] || 'Unknown',
                            price: row['Price'] || 'N/A',
                            url: row['Model URL'] || '',
                            pdfUrl: row['PDF URL'] || ''
                        };
                    }).filter(model => model.url || model.pdfUrl);
                } catch (error) {
                    console.error("Error loading model data:", error);
                    loadingText.textContent = "Error loading data. Please try again.";
                    return [];
                }
            }

            // Create model entities
            function createModelEntities(models) {
                return new Promise((resolve) => {
                    let loadedCount = 0;
                    const totalModels = models.filter(model => model.url).length;
                    
                    if (totalModels === 0) {
                        resolve();
                        return;
                    }
                    
                    modelEntities = models.map((model, index) => {
                        if (!model.url) {
                            return null;
                        }

                        const assetId = `model-${index}`;
                        const assetItem = document.createElement('a-asset-item');
                        assetItem.setAttribute('id', assetId);
                        assetItem.setAttribute('src', model.url);
                        assets.appendChild(assetItem);

                        const entity = document.createElement('a-entity');
                        entity.setAttribute('gltf-model', `#${assetId}`);
                        entity.setAttribute('position', '0 0 0');
                        entity.setAttribute('visible', 'false');
                        entity.setAttribute('class', 'model-entity');
                        
                        entity.addEventListener('model-loaded', () => {
                            loadedCount++;
                            loadingText.textContent = `Loading models (${loadedCount}/${totalModels})...`;
                            
                            if (loadedCount === totalModels) {
                                resolve();
                            }
                        });
                        
                        entity.addEventListener('error', () => {
                            console.error(`Failed to load model: ${model.url}`);
                            loadedCount++;
                            if (loadedCount === totalModels) {
                                resolve();
                            }
                        });
                        
                        modelParent.appendChild(entity);
                        return entity;
                    }).filter(entity => entity !== null);
                });
            }

            // Show 3D viewer
            function show3DViewer() {
                // Make scene visible
                scene.classList.add('active');
                
                // Setup UI elements
                setupButtonEvents();
                scrollLeftBtn.classList.add('active');
                scrollRightBtn.classList.add('active');
                bottomUI.style.display = 'flex';
                backButton.classList.add('active');
                
                // Show the first model
                updateVisibleModel();
            }

            // Zoom functions
            function applyZoom() {
                zoomFactor = Math.max(ZOOM_MIN, Math.min(ZOOM_MAX, zoomFactor));
                modelParent.setAttribute('scale', `${zoomFactor} ${zoomFactor} ${zoomFactor}`);
            }

            function zoomIn() {
                zoomFactor *= 1.1;
                applyZoom();
            }

            function zoomOut() {
                zoomFactor /= 1.1;
                applyZoom();
            }

            // Event listeners for zoom
            window.addEventListener('wheel', (e) => {
                e.preventDefault();
                if (e.deltaY < 0) zoomIn();
                else zoomOut();
            }, { passive: false });

            let initialPinchDistance = null;
            window.addEventListener('touchstart', (e) => {
                if (e.touches.length === 2) {
                    const dx = e.touches[0].clientX - e.touches[1].clientX;
                    const dy = e.touches[0].clientY - e.touches[1].clientY;
                    initialPinchDistance = Math.sqrt(dx * dx + dy * dy);
                }
            });

            window.addEventListener('touchmove', (e) => {
                if (e.touches.length === 2 && initialPinchDistance) {
                    e.preventDefault();
                    const dx = e.touches[0].clientX - e.touches[1].clientX;
                    const dy = e.touches[0].clientY - e.touches[1].clientY;
                    const currentPinchDistance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (currentPinchDistance > initialPinchDistance * 1.05) zoomIn();
                    else if (currentPinchDistance < initialPinchDistance * 0.95) zoomOut();
                    
                    initialPinchDistance = currentPinchDistance;
                }
            }, { passive: false });

            // Start the application
            initApp();
        });
    </script>
</body>
</html>